var port=port||null;var coToolbar=(function(){var y={},s={},r={},x={},m={},l="success",p="fail",n=true,z=null,e=null,d={toolbar:0,infobar:1},i=function(A,B){y[A]=B},w=function(A){return y[A]},j=function(A){var B={};if(y[A]&&y[A].html){B=decodeURI(y[A].html).trim();if(!B){y[A]=null}}return y[A]?true:false},t=function(A){y[A]=null},u=function(B,A){s[B]=A},f=function(A){return s[A]},b=function(A){return s[A]?true:false},q=function(A){s[A]=null},h=function(A,C,B){C.coToolbar=true;if(C.method_name){C.funcName=C.method_name}if(B){chrome.tabs.sendMessage(A,C,B)}else{chrome.tabs.sendMessage(A,C,function(){})}},g=function(A){m[A.method_name](A)},o=function(A){if(A.method_name){g(A)}},a=function(){if(!port){port=chrome.runtime.connectNative("com.nco.namsghst");n=true}if(port&&n){n=false;port.onMessage.addListener(function(A){if(A.messageName!=="chromeDOMMethodCall"||!A.tabId){return}window.setTimeout(o(A),0)});port.onDisconnect.addListener(function(){port=null;n=true})}return port},k=function(A){if(a()){a().postMessage(A)}},c=function(C,A,B){C.result=A;C.messageName="chromeHtmlMessage";C.messageType="callback";if(B){C.reason=B}k(C)};function v(){chrome.windows.getAll(function(A){if(A.length>0){a()}})}setTimeout(v,200);chrome.webNavigation.onCommitted.addListener(function(B){var A=B.tabId,C={},D={};if(!B.frameId){chrome.windows.getCurrent(function(E){if(chrome.runtime.lastError){return}C.funcName="OnCommitted";C.tabId=A;C.windowId=E.id;h(A,C);if(j(A)){D=w(A);if(D){D.fromBG=true;h(A,D)}}})}});chrome.webNavigation.onCompleted.addListener(function(B){var A=B.tabId,C={};if(!B.frameId){C.funcName="OnCompleted";C.tabId=A;h(A,C)}});chrome.browserAction.onClicked.addListener(function(C){var B=C.id,A=C.windowId,D={},E={};r[B]=false;D.funcName="OnBrowserAction";D.tabId=B;D.windowId=A;h(B,D);if(j(B)){E=w(B);if(E){E.fromBG=true;E.userAction=true;h(B,E)}}else{if(z){E.html=z;E.css=e;E.method_name="RenderHtml";E.funcName="RenderHtml";E.tabId=B;E.windowId=A;E.window_type=d.toolbar;E.fromBG=true;E.userAction=true;h(B,E)}}});chrome.tabs.onUpdated.addListener(function(B,A,C){var D={},E={};D.coToolbar=true;D.funcName="OnTabUpdated";D.tabId=B;D.windowId=C.windowId;D.url=C.url;h(B,D);if(j(B)){E=w(B);if(E){E.fromBG=true;h(B,E)}}});chrome.tabs.onActivated.addListener(function(A){var B={};B.coToolbar=true;B.funcName="OnActivated";B.tabId=A.tabId;h(A.tabId,B)});chrome.runtime.onMessage.addListener(function(F,G,B){if(F.coToolbar){if(!G.tab){return}var C=G.tab.id,I=G.tab.windowId,E={},D={},H={};a();switch(F.funcName){case"GetTabId":E.tabId=C;E.windowId=I;break;case"event":F.messageName="chromeHtmlMessage";F.messageType="callback";F.tabId=C;F.windowId=I;k(F);break;case"adjustFrameHeight":D.method_name="adjustFrameHeight";D.height=F.height;window.setTimeout(h(C,D),0);break;case"getScreenRect":F.messageName="chromeHtmlMessage";F.messageType="callback";F.method_name="GetElementLocation";k(F);break;case"updateToolbarChange":if(y[C]&&y[C].html){y[C].html=F.html}break;case"updateInfobarChange":if(s[C]&&s[C].html){s[C].html=F.html}break;case"updateSearchString":x[C]=F.search;break;case"updateLocation":window.setTimeout(h(C,F),0);break;case"getSearchString":if(x[C]){E.search=x[C]}break;case"fullScreenCheck":h(C,F);break;case"RenderHtmlAck":if(!F.toolbarVisible){D.funcName="ReloadIFrame";h(C,D)}break;case"toolbarFrameInjected":window.setTimeout(function(){D.funcName="OnFrameLoaded";D.tabId=C;D.windowId=I;h(C,D);if(j(C)){H=w(C);if(H){H.fromBG=true;h(C,H)}}else{if(z&&!r[C]){H.html=z;H.css=e;H.method_name="RenderHtml";H.funcName="RenderHtml";H.tabId=C;H.windowId=I;H.window_type=d.toolbar;H.fromBG=true;h(C,H)}}},0);break;case"closedToolbar":r[C]=true;z=null;e=null;break;case"EncryptPwd":var J=new Object();if(J){J.messageName=F.funcName;J.windowId=I;J.tabId=C;J.newvalue=F.pwd;var A={};A.cmd="encrypt";A.payload=J;NaclModulePostMessage(A)}break}if(B){B(E)}}});m.GetElementById=function(A){if(!A.id){c(A,p)}h(A.tabId,A,function(B){if(B){if(!B.result){c(A,p)}else{A.id=B.id;A.type=B.type;window.setTimeout(c(A,l),0)}}})};m.GetParentElement=function(A){if(!A.id){c(A,p)}h(A.tabId,A,function(B){if(B){if(!B.result){c(A,p)}else{A.id=B.id;A.type=B.type;window.setTimeout(c(A,l),0)}}})};m.GetElementText=function(A){if(!A.id){c(A,p)}h(A.tabId,A,function(B){if(B){if(!B.result){c(A,p)}else{A.id=B.id;A.type=B.type;A.text=B.text;A.encrypted=B.encrypted;window.setTimeout(c(A,l),0)}}})};m.GetElementHtml=function(A){if(!A.id){c(A,p)}h(A.tabId,A,function(B){if(B){if(!B.result){c(A,p)}else{A.id=B.id;A.type=B.type;A.html=B.html;window.setTimeout(c(A,l),0)}}})};m.GetAttributeByName=function(A){if(!A.id){c(A,p)}h(A.tabId,A,function(B){if(B){if(!B.result){c(A,p)}else{A.id=B.id;A.type=B.type;A.att_value=B.att_value;window.setTimeout(c(A,l),0)}}})};m.GetElementLocation=function(A){if(!A.id){c(A,p)}h(A.tabId,A)};m.RenderHtml=function(A){if(!A.html){c(A,p);return}if(d.toolbar===A.window_type){z=A.html;e=A.css;i(A.tabId,A)}else{if(d.infobar===A.window_type){u(A.tabId,A)}}h(A.tabId,A);c(A,l)};m.ShowToolbar=function(A){if(!A.html){c(A,p)}h(A.tabId,w(A.tabId));c(A,l)};m.ShowInfobar=function(A){if(!A.html){c(A,p)}h(A.tabId,f(A.tabId));c(A,l)};m.SetAttributeByName=function(A){if(!A.id){c(A,p)}h(A.tabId,A)};m.SetElementText=function(A){if(!A.id){c(A,p)}h(A.tabId,A)};m.ReplaceElementHtml=function(A){if(!A.id){c(A,p)}h(A.tabId,A)};m.CloseToolbar=function(A){if(!A.tabId){c(A,p)}t(A.tabId);h(A.tabId,A)};m.CloseInfobar=function(A){if(!A.tabId){c(A,p)}q(A.tabId);h(A.tabId,A)};m.IsToolbarVisible=function(A){if(!A.tabId){c(A,p)}h(A.tabId,A,function(B){A.visibility=B.visibility;window.setTimeout(c(A,l),0)})};m.IsInfobarVisible=function(A){if(!A.tabId){c(A,p)}h(A.tabId,A,function(B){A.visibility=B.visibility;window.setTimeout(c(A,l),0)})}}());